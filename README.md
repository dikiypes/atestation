# Онлайн платформа торговой сети электроники

## Запуск проекта

На машине, где разворачивается проект, должны быть установлены docker и docker-compose.
Для их установки обратитесь к официальной документации.

1. Открыть терминал
2. С помощью команды `cd` перейти в каталог, где будет размещен проект
3. Выполнить команду для клонирования проекта

```bash
git clone https://github.com/dikiypes/atestation.git
```

5. В корневой папке проекта создать файл `.env`

7. Записать в файл `.env` следующие настройки (можно указать свои значения)

Не менять значения `POSTGRES_HOST=db_shop`.

```
POSTGRES_USER=user
POSTGRES_DB=shop_db
POSTGRES_PORT=5432
POSTGRES_PASSWORD=12345
POSTGRES_HOST=db_shop

HOST=127.0.0.1
```

8. Запустить проект с помощью Docker, используя следующую команду:

```bash
docker-compose up --build -d
```

9. Выполнить миграции и загрузить тестовые данные

```bash
docker exec -it api_shop bash -c "python manage.py migrate && python manage.py loaddata data.json && exit"
```

## Тестирование сервиса

Для запуска тестов:

```bash
docker exec -it api_shop /bin/bash -c "coverage run --source='.' manage.py test && coverage report && exit"
```

## Доступ к сервису

Показаны ссылки для случая запуска на локальной машине.

* Swagger: http://127.0.0.1/swagger/
* Административная панель: http://127.0.0.1/admin/

## Описание проекта

После загрузки тестовых данных, что было сделано на шаге 9, будут доступны 2 пользователя.

* Супер пользователь: admin@mail.com, пароль qwerty123!.
* Пользователь max@mail.com, пароль qwerty123!

Проект представляет собой backend-часть для онлайн платформы торговой сети электроники и административную панель.

Реализован следующий функционал:

* авторизация и аутентификация пользователей;
* административная панель;
* CRUD для модели звена цепочки поставщиков;
* CRUD для модели продукта;
* фильтр поставщиков по названию города на административной панели;
* фильтр поставщиков по стране в API.

### Права доступа

После регистрации пользователь автоматически создается с флагом is_staff = True.

**Анонимный пользователь**:

- имеет доступ только к конечной точке регистрации `/users/register/`;
- к остальным конечным точкам API доступа не имеет;
- не имеет доступа к административной панели.

**Аутентифицированный пользователь (активный пользователь):**

- имеет доступ ко всем конечным точкам API;
- имеет доступ к звеньям цепочки поставщиков на административной панели;
- имеет доступ к продуктам на административной панели;
- не имеет доступ к пользователям на административной панели.

**Суперпользователь:**

- имеет доступ ко всем конечным точкам API;
- имеет доступ к звеньям цепочки поставщиков на административной панели;
- имеет доступ к продуктам на административной панели;
- имеет доступ к пользователям на административной панели.

Через административную панель суперпользователь может изменить права доступа для других пользователей:

- сделать пользователя неактивным, тогда этому пользователю будет недоступна авторизация, и, следовательно,
  доступ к API и административной панели;
- отменить статус персонала у пользователя, тогда этому пользователю будет недоступна административная панель.

### Регистрация и авторизация

Пользователи могут зарегистрироваться в системе, а далее авторизоваться.

Авторизация в API происходит с помощью механизма токенов.
Чтобы получить токен, необходимо передать свои учетные данные (электронную почту и пароль)
на конечную точку `/users/token/`. В ответе будет отправлен токен доступа.

Для доступа к защищенным конечным точкам API, этот токен должен быть включен в заголовки
всех последующих HTTP-запросов.
Необходимо добавить его в заголовок Authorization следующим образом:
`Authorization: Bearer ваш_токен`, где `ваш_токен` - это токен, который был получен при входе в систему.

